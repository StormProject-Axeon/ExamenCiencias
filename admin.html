<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            margin: 0;
        }
        h1, h2 {
            margin-bottom: 20px;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .nameLink {
            color: #4CAF50;
            text-decoration: none;
            cursor: pointer;
        }
        .nameLink:hover {
            text-decoration: underline;
        }
        #resetStorage {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 20px;
        }
        #resetStorage:hover {
            background-color: #45a049;
        }
        #backLink {
            margin-top: 20px;
            display: inline-block;
            text-decoration: none;
            color: #4CAF50;
            font-size: 1em;
        }
        #backLink:hover {
            text-decoration: underline;
        }
        #modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        #modalContent {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        #closeModal {
            float: right;
            cursor: pointer;
            font-size: 1.2em;
        }
        .question {
            margin-bottom: 15px;
            text-align: left;
        }
        .correct {
            color: green;
        }
        .incorrect {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Panel de Administración</h1>
    <h2>Usuarios</h2>
    <table id="userTable">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Puntuación</th>
            </tr>
        </thead>
        <tbody id="userTableBody"></tbody>
    </table>
    <h2>Reprobados</h2>
    <table id="failedTable">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Puntuación</th>
            </tr>
        </thead>
        <tbody id="failedTableBody"></tbody>
    </table>
    <button id="resetStorage" onclick="resetStorage()">Resetear Datos</button>
    <br>
    <a id="backLink" href="index.html">Volver al Examen</a>

    <div id="modal">
        <div id="modalContent">
            <span id="closeModal" onclick="closeModal()">×</span>
            <h2>Respuestas de <span id="modalUserName"></span></h2>
            <div id="modalAnswers"></div>
        </div>
    </div>

    <script>
        const questions = [
            { text: 'El principio de Aufbau indica que los electrones ocupan primero los orbitales de mayor energía.', type: 'tf', correct: 'false' },
            { text: 'La configuración del ion Na⁺ es igual a la del neón.', type: 'tf', correct: 'true' },
            { text: 'Los subniveles d contienen hasta 12 electrones.', type: 'tf', correct: 'false' },
            { text: '¿Configuración electrónica del carbono (C, Z=6)?', type: 'mc', correct: 'b', options: { a: '1s² 2s² 2p¹', b: '1s² 2s² 2p²', c: '1s² 2s¹ 2p³', d: '1s² 2s² 2p³' } },
            { text: '¿Qué principio limita a dos electrones por orbital con espines opuestos?', type: 'mc', correct: 'c', options: { a: 'Aufbau', b: 'Hund', c: 'Pauli', d: 'Incertidumbre' } },
            { text: '¿Por qué el cromo (Cr, Z=24) tiene una configuración anómala?', type: 'mc', correct: 'b', options: { a: 'Subnivel 4s lleno', b: 'Subnivel 3d semi-lleno más estable', c: 'Distribución aleatoria', d: 'No sigue Aufbau' } },
            { text: '¿Cómo se escribe la configuración abreviada del potasio (K, Z=19)?', type: 'open', correct: '[Ar] 4s¹' },
            { text: '¿Qué dice la regla de Hund?', type: 'open', correct: 'Los electrones ocupan orbitales de igual energía individualmente con espines paralelos antes de emparejarse.' },
            { text: '¿Por qué es importante la configuración electrónica en la tabla periódica?', type: 'open', correct: 'Organiza los elementos en bloques (s, p, d, f) según los subniveles llenados, explicando propiedades y reactividad.' },
            { text: '¿Por qué el cobre (Cu, Z=29) tiene una configuración anómala?', type: 'open', correct: '[Ar] 4s¹ 3d¹⁰, porque un subnivel 3d lleno es más estable.' }
        ];

        // Función para comparar respuestas abiertas
        function compareAnswers(userAnswer, correctAnswer) {
            if (!userAnswer) return { score: 0, status: 'Incorrecto' };
            const normalize = str => str.toLowerCase()
                .replace(/[¹²³⁴⁵⁶⁷⁸⁹⁰]/g, m => '1234567890'['¹²³⁴⁵⁶⁷⁸⁹⁰'.indexOf(m)])
                .replace(/[\[\]]/g, '') // Quitar corchetes
                .replace(/\s+/g, ' ')
                .trim();
            const user = normalize(userAnswer);
            const correct = normalize(correctAnswer);
            if (user === correct || user.includes(correct.split(',')[0].trim())) {
                return { score: 1, status: 'Correcto' };
            }
            return { score: 0, status: 'Incorrecto' };
        }

        function loadUsers() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userTableBody = document.getElementById('userTableBody');
            const failedTableBody = document.getElementById('failedTableBody');
            userTableBody.innerHTML = '';
            failedTableBody.innerHTML = '';
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="nameLink" onclick="showUserAnswers('${user.name}')">${user.name}</span></td>
                    <td>${user.score}</td>
                `;
                if (user.failed) {
                    failedTableBody.appendChild(row);
                } else {
                    userTableBody.appendChild(row);
                }
            });
        }

        function showUserAnswers(name) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.name === name);
            if (!user) return;

            const modal = document.getElementById('modal');
            const modalUserName = document.getElementById('modalUserName');
            const modalAnswers = document.getElementById('modalAnswers');
            modalUserName.textContent = name;
            modalAnswers.innerHTML = '';

            questions.forEach((q, i) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                const userAnswer = user.answers[`q${i + 1}`] || 'Sin respuesta';
                let status = '';
                let isCorrect = false;
                if (q.type === 'tf' || q.type === 'mc') {
                    isCorrect = userAnswer === q.correct;
                    status = isCorrect ? 'Correcto' : 'Incorrecto';
                } else {
                    const result = compareAnswers(userAnswer, q.correct);
                    isCorrect = result.status === 'Correcto';
                    status = result.status;
                }
                // Para usuarios reprobados, ajustar el estado
                if (user.failed && isCorrect) {
                    status = 'Incorrecto (Correcto)';
                } else if (user.failed && !isCorrect) {
                    status = 'Incorrecto';
                }
                let answerText = userAnswer;
                let correctAnswerText = q.correct;
                if (q.type === 'mc' && userAnswer) {
                    answerText = `${userAnswer}) ${q.options[userAnswer]}`;
                    correctAnswerText = `${q.correct}) ${q.options[q.correct]}`;
                } else if (q.type === 'tf') {
                    answerText = userAnswer === 'true' ? 'Verdadero' : userAnswer === 'false' ? 'Falso' : 'Sin respuesta';
                    correctAnswerText = q.correct === 'true' ? 'Verdadero' : 'Falso';
                }
                questionDiv.innerHTML = `
                    <h3>Pregunta ${i + 1}</h3>
                    <p>${q.text}</p>
                    <p><strong>Respuesta:</strong> ${answerText}</p>
                    <p><strong>Respuesta Correcta:</strong> ${correctAnswerText}</p>
                    <p><strong>Estado:</strong> <span class="${status.includes('Correcto') ? 'correct' : 'incorrect'}">${status}</span></p>
                `;
                modalAnswers.appendChild(questionDiv);
            });

            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function resetStorage() {
            if (confirm('¿Estás seguro de que quieres resetear todos los datos, incluidas las respuestas del examen?')) {
                localStorage.clear();
                loadUsers();
            }
        }

        loadUsers();
    </script>
</body>
</html>